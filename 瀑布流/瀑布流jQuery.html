<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>瀑布流布局jQuery</title>
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        #main{
            position: relative;
        }
        .box{
            padding: 15px 0 0 15px;
            float: left;
        }
        .pic{
            padding: 10px;
            border:1px solid #ccc;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            -webkit-box-shadow: 0 0 5px #ccc;
            -moz-box-shadow: 0 0 5px #ccc;
            box-shadow: 0 0 5px #ccc;
        }
        .pic img{
            width: 165px;
            height:auto;
        }
    </style>
    <script src="../../library/jquery-1.11.3.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function(){
            waterfall();
            var dataInt={"data":[{"src":"images/P_00.jpg"},{"src":"images/P_01.jpg"},{"src":"images/P_02.jpg"},{"src":"images/P_03.jpg"}]};
            $(window).on("scroll",function(){
                if(checkScrollSlide){
                    for(var i=0;i<dataInt.data.length;i++){
                        var oBox=$('<div class="box"></div>').appendTo($("#main"));
                        var oPic=$('<div class="pic"></div>').appendTo(oBox);
                        $('<img src="'+dataInt.data[i].src+'">').appendTo(oPic);
                    }
                    waterfall();
                }
            })
        })
        function waterfall(){
            var $boxs=$("#main>div");
            var w=$boxs.eq(0).outerWidth();
            var cols=Math.floor($(window).width()/w);
            $("#main").width(w*cols).css({"margin":"0 auto"});
            var hArr=[];
            $boxs.each(function(index,ele){
                if(index<cols){
                    hArr.push($boxs.eq(index).outerHeight());
                }else{
                    var minH=Math.min.apply(null,hArr);
                    var minHIndex= $.inArray(minH,hArr);
                    $(ele).css({"position":"absolute","top":minH+"px","left":w*minHIndex+"px"});
                    hArr[minHIndex]+=$boxs.eq(index).outerHeight();
                }
            })
           // console.log(hArr);
        }

        function checkScrollSlide(){
            var $lastBox=$("#main>div").last();
            var lastBoxDis=$lastBox.offset().top+Math.floor($lastBox.outerHeight()/2);
            var scrollTop=$(window).scrollTop();
            var docuemntH=$(window).height();
            return (lastBoxDis<scrollTop+docuemntH)?true:false;
        }
    </script>
</head>
<body>
    <div id="main">
        <div class="box">
            <div class="pic">
                <img src="images/P_00.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_01.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_02.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_03.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_04.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_05.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_06.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_07.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_08.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_09.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_010.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_011.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_012.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_013.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_014.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_015.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_016.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_017.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_018.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_019.jpg" />
            </div>
        </div>
    </div>
</body>
</html>