<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        #main{
            position: relative;
        }
        .box{
            padding: 15px 0 0 15px;
            float: left;
        }
        .pic{
            border: 1px solid #cccccc;
            padding: 10px;
            -webkit-box-shadow: 0 0 5px #ccc;
            -moz-box-shadow: 0 0 5px #ccc;
            box-shadow: 0 0 5px #ccc;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
        }
        img{
            width: 165px;
            height: auto;
        }
    </style>
    <script src="../../library/jquery-1.11.3.js"></script>
    <script type="text/javascript">
        (function(){
            function Waterfall(){
                this.cfg={

                }
            }

            Waterfall.prototype={
                render:function(){
                    var cols=Math.floor(document.documentElement.clientWidth/$(".box:eq(0)").outerWidth());
                    $("#main").css({"width":$(".box:eq(0)").outerWidth()*cols+"px","margin":"0 auto"});
                    var count=$(".box").size(),hArr=[],boxs=$(".box");
                    boxs.each(function(index,ele){
                        if(index<cols){
                            hArr.push(boxs.eq(index).outerHeight());
                        }else{
                            var minH=Math.min.apply(null,hArr);
                            var j=hArr.indexOf(minH);
                            boxs.eq(index).css({"position":"absolute","top":minH,"left":boxs.eq(0).outerWidth()*j});
                            hArr[j]+=boxs.eq(index).outerHeight();
                        }
                    })
                },
                scroll:function(){
                    var that=this;
                    $(window).scroll(function(){
                        var dataInt={"data":[{"src":"images/P_00.jpg"},{"src":"images/P_01.jpg"},{"src":"images/P_02.jpg"},{"src":"images/P_03.jpg"},{"src":"images/P_04.jpg"}]}
                        if(that.checkScroll()){
                            for(var i=0;i<dataInt.data.length;i++){
                                var box=$('<div class="box"></div>').appendTo($("#main"));
                                var pic=$('<div class="pic"></div>').appendTo(box);
                                $('<img>').attr("src",dataInt.data[i].src).appendTo(pic);
                            }
                            that.render();
                        }
                    })
                },
                checkScroll:function(){
                    var h=$("#main>.box").last().offset().top+Math.floor($(".box").last().outerHeight()/3);
                    var scrollTop=$(window).scrollTop();
                    var documentH=$(window).height();
                    return h<scrollTop+documentH;
                },
                init:function(){
                    this.render();
                    this.scroll();
                }
            }

            window.Waterfall=Waterfall;
        })()

        $(function(){
          new Waterfall().init();
        })
    </script>
</head>
<body>
    <div id="main">
        <div class="box">
            <div class="pic">
                <img src="images/P_00.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_01.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_02.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_03.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_04.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_05.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_06.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_07.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_08.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_09.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_010.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_011.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_012.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_013.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_014.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_015.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_016.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_017.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_018.jpg" />
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="images/P_019.jpg" />
            </div>
        </div>

    </div>
</body>
</html>